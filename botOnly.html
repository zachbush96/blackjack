<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bot Blackjack with Optimized Strategy</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        /* justify-content: center; */
        height: 100vh;
        margin: 0;
        background-color: #f4f4f4;
      }

      .game-container {
        text-align: center;
        border: 1px solid #ccc;
        padding: 20px;
        background-color: #fff;
        width: 451px;
      }

      button {
        margin: 5px;
        padding: 10px 20px;
        font-size: 16px;
      }

      .status {
        margin-top: 20px;
      }

      .stats {
        margin-top: 20px;
        font-weight: bold;
      }

      #speedControl {
        width: 200px;
        margin: 10px 0;
      }

    </style>
  </head>

  <body>
    <div class="game-container">
      <h1>Bot Blackjack</h1>
      <h2>Running Count: <span id="runningCount">0</span></h2>
      <p>Bot Balance: $<span id="botBalance">5000</span></p>
      <p>Current Bet: $<span id="botBet">25</span></p>

      <div class="stats">
        <p>Wins: <span id="wins">0</span></p>
        <p>Losses: <span id="losses">0</span></p>
        <p>Win Percentage: <span id="winPercentage">0%</span></p>
        <p>Shuffle Counter: <span id="shuffleCounter">0</span></p>
      </div>

      <div>
        <button id="startButton" onclick="toggleAutoPlay()">
          Start Auto-play
        </button>
        <button onclick="resetGame()">New Game</button>
      </div>

      <div>
        <label for="speedControl">Game Speed:</label>
        <input type="range" id="speedControl" min="1" max="10" value="10" />
      </div>

      <div class="status">
        <p id="dealerHand">Dealer: []</p>
        <p id="botHand">Bot: []</p>
        <p id="message"></p>
      </div>
    </div>

    <script>
      let deck = [];
      let dealerHand = [];
      let botHand = [];
      let botBalance = 5000;
      let botBet = 25;
      let gameActive = false;
      let cardsUsed = 0;
      let runningCount = 0;
      let trueCount = 0;
      let wins = 0;
      let losses = 0;
      let autoPlayInterval;
      let isAutoPlaying = false;
      let shuffleCount = 0; // shuffle Counter
      const numDecks = 10;
      const shuffleThreshold = 0.94;
      //const shuffleThreshold = 0.98;

      function resetGame() {
        botBalance = 5000;
        botBet = 25;
        dealerHand = [];
        botHand = [];
        gameActive = false;
        cardsUsed = 0;
        runningCount = 0;
        wins = 0;
        losses = 0;
        shuffleCount = 0; // reset shuffle counter

        updateUI();
        updateStats();
        updateShuffleCounterDisplay();
      }

      function startGame() {
        if (gameActive) return;
        if (deck.length === 0 || cardsUsed / (52 * numDecks) >= shuffleThreshold) {
          deck = createDeck();
          shuffleDeck(deck);
          cardsUsed = 0;
          runningCount = 0;
          trueCount = 0;
          updateRunningCountDisplay();
        }
        adjustBetSize();
        botHand = [drawCard(), drawCard()];
        dealerHand = [drawCard(), drawCard()];
        gameActive = true;
        document.getElementById('message').innerText = "";

        updateUI();
        botDecision();
      }

      function botDecision() {
        const botHandValue = getHandValue(botHand);
        const dealerVisibleCard = dealerHand[0].value;

        // Adjust strategy based on true count
        if (trueCount >= 3) {
          // More aggressive play when count is high
          if (botHandValue === 16 && dealerVisibleCard === '10') {
            standBot(); // Stand instead of hitting on 16 vs 10
            return;
          }
          if (botHandValue == 15 && dealerVisibleCard === '10') {
            standBot(); // Stand instead of hitting on 15 vs 10
            return;
          }

        }


        if (isPair(botHand)) {
          handlePairSplit(botHandValue, dealerVisibleCard);
        } else if (isSoftHand(botHand)) {
          handleSoftHand(botHandValue, dealerVisibleCard);
        } else {
          handleHardHand(botHandValue, dealerVisibleCard);
        }
      }

      function handlePairSplit(botHandValue, dealerVisibleCard) {
        if (botHandValue === 16) { // Two 8s
          splitBot();
        } else if (botHandValue === 22) { // Two Aces
          splitBot();
        } else if (botHandValue === 18 && !['7', '10', 'A'].includes(dealerVisibleCard)) {
          splitBot(); // Split 9s against most dealer cards
        } else if (botHandValue === 20) {
          standBot(); // Stand on a pair of 10s (20)
        } else if (botHandValue === 12 && ['2', '3', '4', '5', '6', '7'].includes(dealerVisibleCard)) {
          splitBot(); // Split 6s against dealer's 2-7
        } else if (botHandValue === 14 && ['2', '3', '4', '5', '6', '7'].includes(dealerVisibleCard)) {
          splitBot(); // Split 7s against dealer's 2-7
        } else if (botHandValue === 4 && ['5', '6'].includes(dealerVisibleCard)) {
          splitBot(); // Split 2s against dealer's 5-6
        } else if (botHandValue === 6 && ['2', '3', '4', '5', '6'].includes(dealerVisibleCard)) {
          splitBot(); // Split 3s against dealer's 2-6
        } else {
          handleHardHand(botHandValue, dealerVisibleCard); // If no split, follow hard hand logic
        }
      }


      function handleSoftHand(botHandValue, dealerVisibleCard) {
        if (botHandValue <= 17 || (botHandValue === 18 && ['9', '10', 'A'].includes(dealerVisibleCard))) {
          hitBot();
        } else if (botHandValue === 18 && ['9', '10', 'A'].includes(dealerVisibleCard)) {
          hitBot(); // Soft 18 hits against strong dealer cards
        } else {
          standBot();
        }
      }

      function handleHardHand(botHandValue, dealerVisibleCard) {
        if (botHandValue <= 8) {
          hitBot();
        } else if (botHandValue === 9 && ['3', '4', '5', '6'].includes(dealerVisibleCard)) {
          doubleDownBot();
          //} else if (botHandValue === 10 && dealerVisibleCard !== '10' && dealerVisibleCard !== 'A') { // <-- ChatGPT recommended replacing this line with the line below,
        } else if (botHandValue === 10 && ['2', '3', '4', '5', '6', '7', '8', '9'].includes(dealerVisibleCard)) {
          doubleDownBot();
        } else if (botHandValue === 11) {
          doubleDownBot();
        } else if (botHandValue >= 12 && botHandValue <= 16) {
          if (['7', '8', '9', '10', 'J', 'Q', 'K', 'A'].includes(dealerVisibleCard)) {
            hitBot();
          } else {
            standBot();
          }
        } else {
          standBot();
        }
      }

      function splitBot() {
        // When splitting, the bot creates two hands and plays them sequentially
        let firstCard = botHand[0];
        let secondCard = botHand[1];

        // Create two new hands
        let hand1 = [firstCard, drawCard()];
        let hand2 = [secondCard, drawCard()];

        // Play the first hand
        botHand = hand1;
        updateUI();
        botDecision();

        // After finishing the first hand, play the second hand
        botHand = hand2;
        updateUI();
        botDecision();
      }


      function hitBot() {
        botHand.push(drawCard());
        if (getHandValue(botHand) > 21) {
          standBot(); // Bot stands automatically if it busts
        } else {
          updateUI();
          setTimeout(botDecision, getGameSpeed());
        }
      }

      function standBot() {
        while (getHandValue(dealerHand) < 17) {
          dealerHand.push(drawCard());
        }
        checkGameOver();
        updateUI();
        if (isAutoPlaying) {
          setTimeout(startGame, getGameSpeed() * 2);
        }
      }

      function doubleDownBot() {
        botBet *= 2;
        updateUI(); // ChatGPT Suggestion 
        //document.getElementById('botBet').innerText = botBet; // ChatGPT Suggestion
        hitBot();
        standBot();
        botBet = 25; //Reset bet amount after doubleing down (chatGPT recomendation)
        updateUI(); // ChatGPT suggestion
      }

      function createDeck(numDecks = 6) {
        const suits = ['♠', '♥', '♦', '♣'];
        const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
        const deck = [];
        for (let i = 0; i < numDecks; i++) { // Loop to create multiple decks
          for (let suit of suits) {
            for (let value of values) {
              deck.push({
                suit,
                value
              });
            }
          }
        }
        return deck;
      }

      function shuffleDeck(deck) {
        for (let i = deck.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [deck[i], deck[j]] = [deck[j], deck[i]];
        }
        shuffleCount++;
        updateShuffleCounterDisplay();
      }

      function drawCard() {
        if (deck.length === 0 || cardsUsed / (52 * numDecks) >= shuffleThreshold) { // Directly use 52 * numDecks
          deck = createDeck(numDecks); // Pass numDecks to createDeck
          shuffleDeck(deck);
          cardsUsed = 0;
          runningCount = 0;
          updateRunningCountDisplay();
        }
        cardsUsed++;
        const card = deck.pop();
        updateRunningCount(card);
        return card;
      }

      function updateRunningCount(card) {
        if (['10', 'J', 'Q', 'K', 'A'].includes(card.value)) {
          runningCount--;
        } else if (['2', '3', '4', '5', '6'].includes(card.value)) {
          runningCount++;
        }
        updateTrueCount();
        updateRunningCountDisplay();
      }

      function updateTrueCount() {
        const decksRemaining = (deck.length + 52 * numDecks - cardsUsed) / 52;
        trueCount = Math.round(runningCount / decksRemaining);
      }

      function updateRunningCountDisplay() {
        //document.getElementById('runningCount').innerText = runningCount;
        document.getElementById('runningCount').innerText = `${runningCount} (True: ${trueCount})`;
      }

      function updateShuffleCounterDisplay() {
        document.getElementById('shuffleCounter').innerText = shuffleCount;
      }

      function adjustBetSize() {
            if (trueCount >= 1) {
                botBet = Math.max(25, Math.min(botBalance, 25 * (trueCount + 1)));
            } else if (trueCount < 0) {
                botBet = Math.max(10, 25 / (1 - trueCount)); // Less aggressive decrease
            } else {
                botBet = 25; // Default bet when trueCount is between 0 and 1
            }
            document.getElementById('botBet').innerText = botBet;
        }




      function getHandValue(hand) {
        let value = 0;
        let aces = 0;
        for (let card of hand) {
          if (['J', 'Q', 'K'].includes(card.value)) {
            value += 10;
          } else if (card.value === 'A') {
            value += 11;
            aces += 1;
          } else {
            value += parseInt(card.value);
          }
        }
        while (value > 21 && aces > 0) {
          value -= 10;
          aces -= 1;
        }
        return value;
      }

      function isPair(hand) {
        return hand.length === 2 && hand[0].value === hand[1].value;
      }

      function isSoftHand(hand) {
        return hand.some(card => card.value === 'A') && getHandValue(hand) <= 21;
      }

      function checkGameOver() {
        const botValue = getHandValue(botHand);
        const dealerValue = getHandValue(dealerHand);
        const botBlackjack = (botValue === 21 && botHand.length === 2);
        const dealerBlackjack = (dealerValue === 21 && dealerHand.length === 2);

        if (botBlackjack && !dealerBlackjack) {
          botBalance += botBet * 1.5; // Blackjack pays 3:2
          //botBalance += botBet * 1.2; // Blackjack pays 6:5
          document.getElementById('message').innerText = "Bot has Blackjack! Bot wins!";
          wins++;
        } else if (dealerBlackjack && !botBlackjack) {
          botBalance -= botBet;
          document.getElementById('message').innerText = "Dealer has Blackjack! Bot loses.";
          losses++;
        } else if (botValue > 21) {
          botBalance -= botBet;
          document.getElementById('message').innerText = "Bot busts! Bot loses.";
          losses++;
        } else if (dealerValue > 21) {
          botBalance += botBet;
          document.getElementById('message').innerText = "Dealer busts! Bot wins!";
          wins++;
        } else if (botValue > dealerValue) {
          botBalance += botBet;
          document.getElementById('message').innerText = "Bot wins!";
          wins++;
        } else if (botValue < dealerValue) {
          botBalance -= botBet;
          document.getElementById('message').innerText = "Bot loses.";
          losses++;
        } else {
          document.getElementById('message').innerText = "Push! It's a tie.";
        }

        document.getElementById('botBalance').innerText = botBalance;
        botBet = 25; // Reset bet to default
        updateUI();
        gameActive = false;
        updateStats();
      }


      function updateUI() {
        document.getElementById('botHand').innerText = `Bot: ${botHand.map(card => `${card.value}${card.suit}`).join(', ')}`;
        document.getElementById('botBalance').innerText = botBalance;
        document.getElementById('botBet').innerText = botBet;
        if (gameActive) {
          document.getElementById('dealerHand').innerText = `Dealer: ${dealerHand[0].value}${dealerHand[0].suit}, [Hidden]`;
        } else {
          document.getElementById('dealerHand').innerText = `Dealer: ${dealerHand.map(card => `${card.value}${card.suit}`).join(', ')}`;
        }
      }

      function updateStats() {
        document.getElementById('wins').innerText = wins;
        document.getElementById('losses').innerText = losses;
        const totalGames = wins + losses;
        const winPercentage = totalGames > 0 ? ((wins / totalGames) * 100).toFixed(2) : 0;
        document.getElementById('winPercentage').innerText = `${winPercentage}%`;
      }

      function toggleAutoPlay() {
        isAutoPlaying = !isAutoPlaying;
        const startButton = document.getElementById('startButton');
        if (isAutoPlaying) {
          startButton.textContent = 'Stop Auto-play';
          startGame();
        } else {
          startButton.textContent = 'Start Auto-play';
        }
      }

      function getGameSpeed() {
        const speedControl = document.getElementById('speedControl');
        return (11 - speedControl.value) * 50; // Invert the scale so 10 is fastest
      }

      // Initialize the game
      resetGame();

    </script>
  </body>

</html>
